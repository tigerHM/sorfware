elasticsearch 集群主分片和副本分片

官网对文档分片的重要性作了解释：
 Elasticsearch 如何知道一个文档应该存放到哪个分片中呢？当我们创建文档时，它如何决定这个文档应当被存储在分片 1 还是分片 2 中呢？
首先这肯定不会是随机的，否则将来要获取文档的时候我们就不知道从何处寻找了。实际上，这个过程是根据下面这个公式决定的：
shard = hash(routing) % number_of_primary_shards
routing 是一个可变值，默认是文档的 _id ，也可以设置成一个自定义的值。 routing 通过 hash 函数生成一个数字，然后这个数字再除以 number_of_primary_shards （主分片的数量）后得到 余数 。
这个分布在 0 到 number_of_primary_shards-1 之间的余数，就是我们所寻求的文档所在分片的位置。
这就解释了为什么我们要在创建索引的时候就确定好主分片的数量 并且永远不会改变这个数量：因为如果数量变化了，那么所有之前路由的值都会无效，文档也再也找不到了。

集群的健康状态查询：curl -XGET 'localhost:9200/_cluster/health?pretty'
status字段是最为重要的，有三个值：green，yellow，red。三者的含义：
green：所有主分片和副分片都能正常运行；
yellow: 所有主分片都能正常运行，但不是所有副分片都能正常运行；
red：有主分片没能正常运行。
在es中存数据需要先建立索引，而索引实际上是一个或多个物理分片的逻辑命令空间。
一个分片是一个底层的工作单元，存储全部数据中的一部分。它是一个Lucene的实例，本身它就是完整的搜索引擎。
文档被存储和索引在分片中，应用程序直接与索引交互不是与分片交互。

该文章很好的对主分片和副本分片讲解：http://chenzhijun.me/2017/12/18/elasaticearch-shard-replicas/
